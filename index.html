<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Instanews</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>

  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
    
<script>

var sections = ['home', 'opinion', 'world', 'national', 'politics', 'upshot', 'nyregion', 'business', 'technology', 'science', 'health', 'sports', 'arts', 'books', 'movies', 'theater', 'sundayreview', 'fashion', 'tmagazine', 'food', 'travel', 'magazine', 'realestate', 'automobiles', 'obituaries', 'insider']


//4. looping through filtered array of articles to render HTML

var renderArticlesAsHtml = function (arrayToRender) {
  var clone = $("#clone").clone();
  var resultCloneThing;
  for (var i = 0; i < arrayToRender.length; i++) {
    var abstract = arrayToRender[i].abstract;
    var imageUrl = arrayToRender[i].multimedia[4].url;
    var articleUrl = arrayToRender[i].url;
  
    $(clone).children("p").text(abstract);
    $(clone).attr("id","");
    $(clone).attr("href",articleUrl);
    $(clone).addClass("rendered");
    $(clone).css('background-image', 'url("' + imageUrl + '")');
    $(".articles-container").append(clone[0].outerHTML);
  }


};

//3. extracting and saving 12 articles that have photos
var getFilteredArticles = function (receivedData) {
    var allArticles = [];
    var articles = receivedData['results'];
    var filteredArticles = articles.filter(function(article) {
      return article.multimedia.length > 0;
    }).slice(0, 12);

    console.log(filteredArticles);

    renderArticlesAsHtml (filteredArticles);
}
//2. onReadyFn sends get request to NYT and receives result
var onReadyFn = function (someSection) {

    console.log("document loaded. onReadyFn is executing");
    var selectedSection = someSection;
    console.log("selected section is "+ selectedSection);
    //debugger;
    var url = "https://api.nytimes.com/svc/topstories/v2/" + selectedSection + ".json";
    url += '?' + $.param({
      'api-key': "0005835ede544efe89fbe3d6b4f8c386"
    });
    console.log (url);


    $.ajax({
      url: url,
      method: 'GET',
    }).done(function(topStories) {
      console.log(topStories);
      getFilteredArticles(topStories);
    }).fail(function(err) {
      throw err;
    });

}
/* How to refactor:
var init = function () {
  init: {

  },
  call : {
    $.ajax({
      url: url,
      method: 'GET',
    }).done(function(topStories) {
      console.log(topStories);
      getFilteredArticles(topStories);
    }).fail(function(err) {
      throw err;
    });
  },
  url : {
    var url = "https://api.nytimes.com/svc/topstories/v2/" + selectedSection + ".json";
    url += '?' + $.param({
      'api-key': "0005835ede544efe89fbe3d6b4f8c386"
    });
  }
}
init.call();
*/

//1. listening to selecting section click
$(document).ready(function(){

  $('body').on('change', 'select', function() {
   var mySection = $(this).val();


  $(".rendered").remove(); //deletes all loaded previously articles if any
   onReadyFn(mySection)
  });
});


  </script>
</head>


<body>
<div class="flex flex-column-all">
  <header class = "flex flex-center flex-column-mb flex-grow-mb flex-justify-start-tb">
    <img src="css/assets/images/nyt-logo.svg">
    <section class = "flex flex-center flex-column-all">
      <h4>Choose a section:</h4>
      <select id="selectedSection">
        <option>Sections...</option>
        <option value="home">Home</option>
        <option value="opinion">Opinion</option>
        <option value="world">World</option>
        <option value="national">National</option>
        <option value="politics">Politics</option>
        <option value="upshot">Upshot</option>
        <option value="nyregion">NY Region</option>
        <option value="business">Business</option>
        <option value="technology">Technology</option>
        <option value="science">Science</option>
        <option value="health">Health</option>
        <option value="sports">Sports</option>
        <option value="arts">Arts</option>
        <option value="books">Books</option>
        <option value="world">World</option>
        <option value="movies">Movies</option>
        <option value="theater">Theater</option>
        <option value="sundayreview">Sunday Review</option>
        <option value="fashion">Fashion</option>
        <option value="tmagazine">TMagazine</option>
        <option value="food">Food</option>
        <option value="travel">Travel</option>
        <option value="realestate">Real Estate</option>
        <option value="automobiles">Automobiles</option>
        <option value="obituaries">Obituaries</option>
        <option value="insider">Insider</option>

      </select>
    </section>
  </header> 
  <section class="flex flex-center flex-column-mb articles-container" id="output">
  <a href="" id="clone" class="article-box">
    <p></p>
  </a>
  </section>
</div>
<footer class="text-center">&#169 Copyright 2017 INSTANEWS</footer>




</body>
</html>